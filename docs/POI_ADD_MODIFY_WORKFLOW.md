# Adding or Modifying POIs: Step-by-Step Workflow

This document explains the precise process for adding new Points of Interest (POIs) or modifying existing ones in the Nightreign Router project. It covers SVG coordinate extraction, updating the master POI list, reseeding the database, and verifying changes on the map.

---

## 1. Add or Update POI SVGs
- Place new or updated SVG files for each POI type/category in the appropriate coordinate data directory, e.g.:
  - `public/assets/maps/coordinates/the_mountaintop_coordinate_data/`
  - `public/assets/maps/coordinates/the_rotten_woods_coordinate_data/`
- Each SVG should represent a POI type and contain the correct path data for the POI's location(s).

> **Note:** If the same POI is meant to appear in multiple layouts, ensure the coordinates are exactly identical in all relevant SVGs. For example, Minor_Locations POI (IDs 157, 160, 161, 163) were deduplicated by standardizing their coordinates to [1873, 992] in all layouts except Rotten Woods. This ensures global POI numbering and icon placement remain consistent.

## 2. Extract Coordinates from SVGs
- Use the provided script to extract coordinates from the SVGs:
  ```sh
  python3 public/assets/maps/coordinates/extract_svg_coordinates.py public/assets/maps/coordinates/default_coordinate_data/ public/assets/maps/coordinates/default_map_layout.json
  python3 public/assets/maps/coordinates/extract_svg_coordinates.py public/assets/maps/coordinates/noklateo_coordinate_data/ public/assets/maps/coordinates/noklateo_map_layout.json
  python3 public/assets/maps/coordinates/extract_svg_coordinates.py public/assets/maps/coordinates/the_crater_coordinate_data/ public/assets/maps/coordinates/the_crater_map_layout.json
  python3 public/assets/maps/coordinates/extract_svg_coordinates.py public/assets/maps/coordinates/the_mountaintop_coordinate_data/ public/assets/maps/coordinates/the_mountaintop_map_layout.json
  python3 public/assets/maps/coordinates/extract_svg_coordinates.py public/assets/maps/coordinates/the_rotten_woods_coordinate_data/ public/assets/maps/coordinates/the_rotten_woods_map_layout.json
  ```
- This will generate or update the relevant layout JSON (e.g., `the_mountaintop_map_layout.json`) with the new coordinates.

## 3. Regenerate the Master POI List
- Run the script to deduplicate and assign unique, sequential numbers to all POIs across all layouts:
  ```sh
  node scripts/generate_poi_ids.cjs
  ```
- This will update `public/assets/maps/poi_coordinates_with_ids.json` with the new, locked numbering scheme.
- **Do not edit this file by hand.**

## 4. Reseed the Database
- Run the database seed script to update the backend with the new POIs and their numbers:
  ```sh
  npm run db:seed
  ```
- This ensures the backend and frontend are in sync.

## 5. Verify on the Map
- Start the development server and check the map in the browser.
- Confirm that the new or updated POIs appear at the correct locations, with the correct numbers, and are unique across all layouts.

## 6. (Optional) Update CSV/Pattern Mapping
- If the new POIs need to be referenced in the pattern CSV or mapped to names, update `prisma/poi_name_coordinate_map.js` and any relevant mapping logic.

---

## 7. Add or Modify POI Icons
- Place your new icon PNG files in the `public/POI_icons/` directory.
- Open `src/app/_components/MapCanvas.tsx` and do the following:
  1. **Add the icon filename** to the `POI_ICONS` array.
  2. **Add a size entry** for your icon in the `POI_ICON_SIZES` object (optional, for custom sizing).
  3. **Add a mapping** from your POI type (as used in the coordinate JSONs) to the icon filename in the `POI_TYPE_ICON_MAP` object.
  4. **Add a useImage call** for your icon (e.g., `const myIconImg = useImage("/POI_icons/My_Icon.png")[0];`).
  5. **Add your icon image** to the `poiImages` array in the same order as `POI_ICONS`.
- Example for a new POI type `Event_Locations` with icon `Event.png`:
  - Add to `POI_ICONS`: `"Event.png",`
  - Add to `POI_ICON_SIZES`: `"Event.png": { width: 64 },`
  - Add to `POI_TYPE_ICON_MAP`: `"Event_Locations": "Event.png",`
  - Add to image loading: `const eventImg = useImage("/POI_icons/Event.png")[0];`
  - Add to `poiImages`: `eventImg,`
- Save and rebuild the project to see your new icons on the map.

---

## Key Points
- **Never edit `